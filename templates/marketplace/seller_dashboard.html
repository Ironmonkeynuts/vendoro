{% extends "base.html" %}
{% block title %}Seller Dashboard — Vendoro{% endblock %}

{% block content %}
<h1 class="h4 mb-3">Seller dashboard</h1>

<ul class="nav nav-tabs mb-3" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-inventory" type="button" role="tab">Inventory</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-alerts" type="button" role="tab">Alerts</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-stats" type="button" role="tab">Stats</button>
  </li>
</ul>

<div class="tab-content">
    <div id="tab-inventory" class="tab-pane fade show active" role="tabpanel">
    {% if inventory_by_shop %}
        {% for shop, plist in inventory_by_shop.items %}
        <div class="mb-4">
            <div class="d-flex justify-content-between align-items-center mb-2">
            <h2 class="h6 mb-0">{{ shop.name }}</h2>
            <a class="btn btn-sm btn-outline-primary" href="{% url 'marketplace:product_create' slug=shop.slug %}">Add product</a>
            </div>
            <div class="table-responsive">
            <table class="table align-middle">
                <thead>
                <tr>
                    <th>Product</th>
                    <th class="text-end">Price</th>
                    <th class="text-center">Reviews</th>
                    <th>Created</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                {% for p in plist %}
                    <tr>
                    <td>
                        <a href="{% url 'marketplace:product_detail' shop_slug=p.shop.slug product_slug=p.slug %}">{{ p.title }}</a>
                        {% if p.category %}<div class="text-muted small">{{ p.category.name }}</div>{% endif %}
                    </td>
                    <td class="text-end">£{{ p.price|floatformat:2 }}</td>
                    <td class="text-center">
                        {% if p.review_count %}
                        {{ p.review_avg|floatformat:1 }}/5 ({{ p.review_count }})
                        {% else %}
                        <span class="text-muted">—</span>
                        {% endif %}
                    </td>
                    <td>{{ p.created_at|date:"Y-m-d" }}</td>
                    <td class="text-end">
                        <a class="btn btn-sm btn-outline-secondary" href="{% url 'marketplace:product_edit' pk=p.id %}">Edit</a>
                    </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">No active products yet.</p>
    {% endif %}
    </div>

    <div id="tab-alerts" class="tab-pane fade" role="tabpanel">
        <p class="text-muted">Recent transactions & new reviews will appear here.</p>
    </div>

    <div id="tab-stats" class="tab-pane fade" role="tabpanel">
        <p class="text-muted">Sales stats will appear here.</p>
    </div>
</div>
{% endblock %}
